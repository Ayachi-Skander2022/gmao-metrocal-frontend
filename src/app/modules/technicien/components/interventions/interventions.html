<div style="border-bottom: 2px solid #0a1c42; padding-bottom: 6px; margin-bottom: 16px;">
  <h2 style=" font-size: 20px; font-weight: 600; color: #0a1c42; display: flex; text-transform: uppercase; align-items: center; gap: 20px;">
    <i nz-icon nzType="container" nzTheme="outline"></i>
    Liste des demandes d'étalonnage
  </h2>
</div>

<!-- RECHERCHE -->
<nz-input-group [nzSuffix]="suffixIcon" nzSearch class="modern-search">
  <input
    type="text"
    nz-input
    placeholder="🔍 Rechercher un instrument..."
    [(ngModel)]="searchText"
    (ngModelChange)="onSearch()"
    class="search-input"
  />
  <ng-template #suffixIcon>
    <i nz-icon nzType="search"></i>
  </ng-template>
</nz-input-group>

<br /><br />

<nz-table
  #nzTable
  [nzData]="filteredDemandes"
  [nzPageSize]="5"
  [nzFrontPagination]="true"
    [nzBordered]="true"
  [nzLoading]="loading"
  [nzShowPagination]="true"
  [nzShowSizeChanger]="true"
  [nzShowQuickJumper]="true"
  [nzScroll]="{ x: '1000px' }"
  class="modern-table"
>
  <thead>
    <tr>
      <th>Client</th>
      <th>Code Instrument</th>
      <th>Nom Instrument</th>
      <th>Type Mesure</th>
       <th>Mesure (Min | Max)</th>
      <th>Type Étalonnage</th>
      <th>Date Souhaitee</th>
      <th>Date demande</th>

        <th>Statut Etalonnage</th>

           <th>Intervention</th>

    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let d of nzTable.data">

        <td >
        {{ d.client?.fullName}}
 
        </td>
      <td>{{ d.instrument?.codeInstrument }}</td>
      <td>{{ d.instrument?.nomInstrument }}</td>
    <td>{{ d.instrument?.typeMesure }} - {{ d.instrument?.uniteMesure }}</td>
    <td>{{ d.instrument?.minMesure }} | {{ d.instrument?.maxMesure }} </td>
      <td>{{ d.typeEtalonnage }}</td>
      <td> {{ d.dateSouhaitee | date: 'shortDate' }} </td>
      <td>{{ d.dateDemande | date: 'shortDate' }}</td>
   
     
     <!-- État Étalonnage -->
      <td>
        <ng-container *ngIf="d.statutDemande !== 'REJECTED'">
          <nz-tag *ngIf="d.statutEtalonnage === 'EN_ATTENTE'" nzColor="processing">
            <span nz-icon nzType="sync" nzSpin></span> En attente
          </nz-tag>
          <nz-tag *ngIf="d.statutEtalonnage === 'EN_COURS'" nzColor="blue">
            <span nz-icon nzType="loading" nzSpin></span> En cours
          </nz-tag>
          <nz-tag *ngIf="d.statutEtalonnage === 'ETALONNE'" nzColor="success">
            <span nz-icon nzType="check-circle"></span> Terminé
          </nz-tag>
        </ng-container>
         <ng-container *ngIf="d.statutDemande === 'REJECTED'">
            <span style="color: #999; font-style: italic;">Demande rejetée</span>
       </ng-container>
      </td>


 
      <td>
  <button
  *ngIf="d.statutEtalonnage !== 'ETALONNE'"
    nz-button
    nzType="primary"
    nzShape="circle"
    nz-tooltip="Créer une intervention"
    (click)="openModal(d, modalTitleTemplate, modalContentTemplate)"
  >


           <i nz-icon nzType="plus-circle" nzTheme="outline"></i>

  </button>

    <ng-container *ngIf="d.statutEtalonnage === 'ETALONNE'">
       <span class="iconInt" nz-icon nzType="check-circle"></span>
       </ng-container>
      
</td>



    

  </tr>
  </tbody>
</nz-table>


<ng-template #modalTitleTemplate>
  <div class="modal-title-custom">
    <i nz-icon nzType="plus-circle" class="icon-title"></i>
    Creé Intervention
  </div>
</ng-template>


<ng-template #modalContentTemplate>
  <form [formGroup]="interventionForm" nz-form class="modern-form">
    
    <nz-form-item>
      <nz-form-control nzErrorTip="Veuillez saisir l'étalon utilisé">
        <nz-input-group nzPrefixIcon="tool">
          <input nz-input formControlName="etalonUtilise" placeholder="Nom de l'étalon utilisé" />
        </nz-input-group>
      </nz-form-control>
    </nz-form-item>

  <nz-form-item>
  <nz-form-control nzErrorTip="Veuillez saisir les mesures étalon (ex: 25, 50, 80)">
    <nz-input-group nzPrefixIcon="line-chart">
      <input
        nz-input
        formControlName="mesureEtalon"
        placeholder="Mesures étalon (séparées par des virgules)" />
    </nz-input-group>
  </nz-form-control>
</nz-form-item>

<nz-form-item>
  <nz-form-control nzErrorTip="Veuillez saisir les mesures instrument (ex: 25.2, 49.9, 80)">
    <nz-input-group nzPrefixIcon="dot-chart">
      <input
        nz-input
        formControlName="mesureInstrument"
        placeholder="Mesures instrument (séparées par des virgules)" />
    </nz-input-group>
  </nz-form-control>
</nz-form-item>


    <nz-form-item>
      <nz-form-control nzErrorTip="Veuillez saisir la durée d'étalonnage">
        <nz-input-group nzPrefixIcon="clock-circle">
          <input nz-input formControlName="dureeEtalonnage" placeholder="Durée d'étalonnage (ex: 25 minutes)" />
        </nz-input-group>
      </nz-form-control>
    </nz-form-item>

    <div style="text-align: right; margin-top: 16px;">
      <button
        nz-button
        nzType="default"
        nzShape="round"
        class="cancel-button"
        (click)="modalRef?.close(); isModalVisible = false"
      >
        <i nz-icon nzType="close"></i>
        Annuler
      </button>

      <button
        nz-button
        nzType="primary"
        nzShape="round"
        class="modern-button"
        htmlType="submit"
        [disabled]="interventionForm.invalid"
        (click)="onsubmit()"
        style="margin-left: 8px;"
      >
        <i nz-icon nzType="plus-circle" style="margin-right: 6px;"></i>
        Ajouter
      </button>
    </div>
  </form>
</ng-template>



    

  